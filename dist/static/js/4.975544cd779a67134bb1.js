webpackJsonp([4],{QNdq:function(e,t){},cBIK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={data:()=>({article:{tags:[],cate:{}},showLimit:10,showAllCate:!1,showAllTag:!1,categories:[],tags:[],managing:!1,needRefreshSelectStatus:0,inputCateVisible:!1,inputCateValue:"",inputTagVisible:!1,inputTagValue:""}),mounted(){this.getAllTag(),this.getAllCategory()},methods:{getAllTag:function(){this.$api.getSiteInfo().then(e=>{this.tags=e.data.data.tagList})},getAllCategory:function(){this.$api.getSiteInfo().then(e=>{this.categories=e.data.data.cateList})},newCate(e){this.$api.newCate(e).then(e=>{this.$message.success("新增分类成功:"+e.data.data.name),this.getAllCategory()})},deleteCate(e){this.$api.delCate(e).then(e=>{this.$message.success("删除分类成功"),this.getAllCategory()})},deleteTag(e){this.$api.delTag(e).then(e=>{this.$message.success("删除标签成功"),this.getAllTag()})},getArticleMetaInfo(){this.$api.getArticleMetaInfo(this.article.id).then(e=>{const{category:t,tags:a}=e.data.data;if(this.article.cate=t,this.article.tags=a,t&&this.categories.filter(e=>e.id===this.article.cate.id).forEach(e=>{e.checked=!0}),a){let e=a.map(e=>e.id);this.tags.filter(t=>-1!==e.indexOf(t.id)).forEach(e=>{e.checked=!0})}this.needRefreshSelectStatus++})},saveMetaInfo(){let e=this.categories.find(e=>!0===e.checked),t=this.tags.filter(e=>!0===e.checked).map(e=>e.id);this.$api.saveMetaInfo(this.article.id,e?e.id:null,t).then(e=>{this.$message.success("保存文章数据成功")})},cancelOtherCate(e,t){t&&this.categories.filter(t=>t.id!==e.id&&!0===t.checked).forEach(e=>{e.checked=!1})},showTagInput(){this.inputTagVisible=!0,this.$nextTick(function(){this.$refs.input.focus()})},showCateInput(){this.inputCateVisible=!0,this.$nextTick(function(){this.$refs.input.focus()})},handleCateInputChange(e){this.inputCateValue=e.target.value},handleTagInputChange(e){this.inputTagValue=e.target.value},handleCateInputConfirm(){const e=this.inputCateValue;let t=this.categories;e&&-1===t.indexOf(e)&&(t=[{name:e},...t],this.$api.newCate(e).then(e=>{this.$message.success("新增标分类成功:"+e.data.data.name),this.getAllCategory()})),Object.assign(this,{categories:t,inputCateVisible:!1,inputCateValue:""})},handleTagInputConfirm(){const e=this.inputTagValue;let t=this.tags;e&&-1===t.indexOf(e)&&(t=[{name:e},...t],this.$api.newTag(e).then(e=>{this.$message.success("新增标签成功:"+e.data.data.name),this.getAllTag()})),Object.assign(this,{tags:t,inputTagVisible:!1,inputTagValue:""})}},created(){this.$bus.$on("articleEditMetaInit",e=>{console.log("bus on ono no non on o"),this.article={id:e.id},this.getAllTag(),this.getAllCategory(),this.getArticleMetaInfo()})}},i={render:function(){var e=this,t=this,a=t.$createElement,n=t._self._c||a;return n("div",{staticClass:"edit-left-side"},[this.$store.state.isLogin?n("a-checkable-tag",{on:{change:function(t){return e.managing=t}},model:{value:t.managing,callback:function(e){t.managing=e},expression:"managing"}},[t._v("管理\n  ")]):t._e(),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"cate-container"},[t.managing?n("div",t._l(t.categories,function(e,a){return a<=t.showLimit||t.showAllCate?n("a-tag",{key:e.id,staticClass:"my-tag",attrs:{closable:""},on:{close:function(a){return t.deleteCate(e.id)}}},[t._v(" "+t._s(e.name)+"\n      ")]):t._e()}),1):n("div",t._l(t.categories,function(e,a){return a<=t.showLimit||t.showAllCate?n("a-checkable-tag",{key:t.needRefreshSelectStatus,staticClass:"my-tag",on:{change:function(a){return t.cancelOtherCate(e,a)}},model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"cate.checked"}},[t._v(" "+t._s(e.name)+"\n      ")]):t._e()}),1),t._v(" "),t.managing?n("div",[t.inputCateVisible?n("a-input",{ref:"input",style:{width:"78px"},attrs:{type:"text",size:"small",value:t.inputCateValue},on:{change:t.handleCateInputChange,blur:t.handleCateInputConfirm,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleCateInputConfirm.apply(null,arguments)}}}):n("a-tag",{staticStyle:{background:"#fff",borderStyle:"dashed"},on:{click:t.showCateInput}},[n("a-icon",{attrs:{type:"plus"}}),t._v("\n        New Cate\n      ")],1)],1):t._e(),t._v(" "),n("div",[n("a-checkable-tag",{on:{change:function(t){return e.showAllCate=t}},model:{value:t.showAllCate,callback:function(e){t.showAllCate=e},expression:"showAllCate"}},[t.showAllCate?n("span",[t._v("收起")]):n("span",[t._v("更多...")])])],1)]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"tag-container"},[t.managing?n("div",t._l(t.tags,function(e,a){return a<=t.showLimit||t.showAllTag?n("a-tag",{key:e.id,attrs:{closable:"",calss:"my-tag"},on:{close:function(a){return t.deleteTag(e.id)}}},[t._v("\n        "+t._s(e.name)+"\n      ")]):t._e()}),1):n("div",t._l(t.tags,function(e,a){return a<=t.showLimit||t.showAllTag?n("a-checkable-tag",{key:t.needRefreshSelectStatus,attrs:{calss:"my-tag"},on:{change:function(e){t.needRefreshSelectStatus++}},model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"tag.checked"}},[t._v("\n        "+t._s(e.name)+"\n      ")]):t._e()}),1),t._v(" "),t.managing?n("div",[t.inputTagVisible?n("a-input",{ref:"input",style:{width:"78px"},attrs:{type:"text",size:"small",value:t.inputTagValue},on:{change:t.handleTagInputChange,blur:t.handleTagInputConfirm,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleTagInputConfirm.apply(null,arguments)}}}):n("a-tag",{staticStyle:{background:"#fff",borderStyle:"dashed"},on:{click:t.showTagInput}},[n("a-icon",{attrs:{type:"plus"}}),t._v("\n        New Tag\n      ")],1)],1):t._e(),t._v(" "),n("div",[n("a-checkable-tag",{on:{change:function(t){return e.showAllTag=t}},model:{value:t.showAllTag,callback:function(e){t.showAllTag=e},expression:"showAllTag"}},[t.showAllTag?n("span",[t._v("收起")]):n("span",[t._v("更多...")])])],1)]),t._v(" "),n("hr"),t._v(" "),n("a-button",{on:{click:t.saveMetaInfo}},[t._v("更新")])],1)},staticRenderFns:[]};var s=a("VU/8")(n,i,!1,function(e){a("QNdq")},"data-v-600bd24d",null);t.default=s.exports}});